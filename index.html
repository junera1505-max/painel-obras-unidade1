<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Acompanhamento de Obras</title>
    
    <style>
        /* CSS PROFISSIONAL RESTAURADO */
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap');
        body, html { margin: 0; padding: 0; font-family: 'Poppins', sans-serif; color: #333; height: 100%; overflow: hidden; background-color: #f4f7fa; }
        * { box-sizing: border-box; }
        .system-container { display: flex; height: 100vh; }
        
        /* Barra lateral Azul Escuro Profissional */
        .sidebar { 
            width: 280px; 
            background-color: #0d1b2a; /* Azul Marinho Profissional */
            color: white; 
            padding: 20px; 
            display: flex; 
            flex-direction: column; 
            flex-shrink: 0; 
            border-right: 1px solid rgba(255, 255, 255, 0.1); 
            box-shadow: 2px 0 10px rgba(0,0,0,0.1); 
            overflow-y: auto; 
            position: relative; 
            z-index: 10; 
        }

        .sidebar-header .company-logo { width: 80%; margin: 0 auto 30px auto; display: block; }
        #main-nav { flex-grow: 1; overflow-y: auto; }
        #main-nav ul { list-style-type: none; padding: 0; margin: 0; }
        #main-nav li a { 
            display: block; 
            padding: 12px 15px; 
            color: #a0aec0; 
            text-decoration: none; 
            border-radius: 8px; 
            margin-bottom: 5px; 
            font-weight: 500; 
            transition: all 0.2s ease; 
            cursor: pointer; 
        }
        #main-nav li a:hover { background-color: rgba(255, 255, 255, 0.05); color: white; }
        #main-nav li a.active { background-color: #ffffff; color: #0d1b2a; font-weight: 600; }

        .content-area { flex-grow: 1; padding: 40px; overflow-y: auto; background-color: #f4f7fa; position: relative; }
        .content-header h1 { font-size: 2rem; color: #1e3a5f; margin: 0; }
        
        .btn-primary { background-color: #007bff; color: white; padding: 10px 20px; border-radius: 6px; border: none; cursor: pointer; font-weight: 600; }
        #btn-adicionar-contrato { 
            width: 100%; 
            padding: 12px; 
            background-color: #38a169; 
            color: white; 
            border: none; 
            border-radius: 8px; 
            font-weight: 600; 
            cursor: pointer; 
            margin-top: 20px;
        }

        /* Estilos de Dashboard e Tabelas */
        .dashboard-grid { display: grid; grid-template-columns: 1fr; gap: 20px; margin-top: 20px; }
        .metric-card { background: white; padding: 20px; border-radius: 12px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); border: 1px solid #e2e8f0; }
        .metric-card .value { font-size: 2rem; font-weight: 700; color: #2b6cb0; }
        .progress-bar-container { background: #edf2f7; border-radius: 10px; height: 20px; overflow: hidden; margin: 10px 0; }
        .progress-bar-fill { background: #48bb78; height: 100%; transition: width 0.5s ease; }
    </style>
</head>
<body>

    <div class="system-container">
        <aside class="sidebar">
            <header class="sidebar-header">
                <img src="imagem2.png" alt="Logo" class="company-logo">
            </header>
            <nav id="main-nav"><ul></ul></nav>
            <div class="sidebar-footer">
                <button id="btn-adicionar-contrato">+ Adicionar Novo Contrato</button>
            </div>
        </aside>
        <main id="content-area" class="content-area">
            <div class="welcome-message">
                <h1>Carregando...</h1>
                <p>Buscando dados mais recentes.</p>
            </div>
        </main>
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', () => {
        const urlParams = new URLSearchParams(window.location.search);
        const isAdmin = urlParams.get('modo') === 'edicao'; 
        const JSONBIN_URL = 'https://api.jsonbin.io/v3/b/68e8e81ad0ea881f409c51f0'; 
        const API_KEY = '$2a$10$L4n/qlQ8LGkgQmd9p7zhaOAK6j5pgA.2Tq7xK019hUqDGNfPmqJ5O'; 

        let database = { obras: [], comuniqueses: [] };
        const navList = document.querySelector('#main-nav ul');
        const contentArea = document.getElementById('content-area');

        // Formatações
        const formatCurrency = (v) => (v || 0).toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });

        async function carregarDados() { 
            try { 
                const r = await fetch(JSONBIN_URL, { headers: { 'X-Master-Key': API_KEY } }); 
                const data = await r.json(); 
                database = data.record; 
                renderizarNavegacao();
                // Forçar o carregamento da Visão Geral no início
                mostrarVisaoGeral();
            } catch (e) { 
                contentArea.innerHTML = "<h1>Erro ao carregar dados.</h1>";
                console.error(e);
            } 
        }

        function renderizarNavegacao() {
            navList.innerHTML = `
                <li><a data-id="visao-geral" class="active">Visão Geral</a></li>
                <li><a data-id="comuniqueses">Comunique-se</a></li>
                <li><a data-id="metas-acumuladas">Metas Acumuladas</a></li>
            `;
            
            database.obras.forEach(obra => {
                navList.innerHTML += `<li><a data-id="${obra.id}">${obra.nomeCurto}</a></li>`;
            });

            navList.querySelectorAll('a').forEach(link => {
                link.addEventListener('click', (e) => {
                    document.querySelectorAll('#main-nav a').forEach(a => a.classList.remove('active'));
                    e.target.classList.add('active');
                    roteador(e.target.dataset.id);
                });
            });
        }

        function roteador(id) {
            if (id === 'visao-geral') mostrarVisaoGeral();
            else if (id === 'comuniqueses') contentArea.innerHTML = "<h1>Comunique-se</h1><p>Conteúdo em desenvolvimento.</p>";
            else if (id === 'metas-acumuladas') contentArea.innerHTML = "<h1>Metas Acumuladas</h1>";
            else {
                const obra = database.obras.find(o => o.id === id);
                if (obra) mostrarPaginaObra(obra);
            }
        }

        function mostrarVisaoGeral() {
            const totalImob = database.obras.reduce((acc, o) => acc + (o.dadosImobilizacao?.atual || 0), 0);
            contentArea.innerHTML = `
                <div class="content-header"><h1>Visão Geral do Projeto</h1></div>
                <div class="dashboard-grid">
                    <div class="metric-card">
                        <div class="label">Total Imobilizado</div>
                        <div class="value">${formatCurrency(totalImob)}</div>
                    </div>
                </div>
            `;
        }

        function mostrarPaginaObra(obra) {
            contentArea.innerHTML = `
                <div class="content-header"><h1>${obra.nomeCompleto}</h1></div>
                <div class="dashboard-grid">
                    <div class="metric-card">
                        <h3>Progresso da Obra</h3>
                        <div class="progress-bar-container">
                            <div class="progress-bar-fill" style="width: 70%"></div>
                        </div>
                    </div>
                </div>
            `;
        }

        if (!isAdmin) document.getElementById('btn-adicionar-contrato').style.display = 'none';

        carregarDados();
    });
    </script>
</body>
</html>
