<!DOCTYPE html>
<html lang="pt-BR">
<head>
Â  Â  <meta charset="UTF-8">
Â  Â  <meta name="viewport" content="width=device-width, initial-scale=1.0">
Â  Â  <title>Sistema de Acompanhamento de Obras</title>
Â  Â Â 
Â  Â  <style>
Â  Â  Â  Â  /* CSS completo, sem alteraÃ§Ãµes */
Â  Â  Â  Â  @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap');
Â  Â  Â  Â  body, html { margin: 0; padding: 0; font-family: 'Poppins', sans-serif; color: #333; height: 100%; overflow: hidden; background-color: #f4f7fa; }
Â  Â  Â  Â  * { box-sizing: border-box; }
Â  Â  Â  Â  .system-container { display: flex; height: 100vh; transition: all 0.3s ease-in-out; }
Â  Â  Â  Â  .sidebar { width: 280px; background-color: rgba(30, 58, 95, 0.85); color: white; padding: 20px; display: flex; flex-direction: column; flex-shrink: 0; border-right: 1px solid rgba(255, 255, 255, 0.1); box-shadow: 2px 0 10px rgba(0,0,0,0.1); transition: width 0.3s ease-in-out, opacity 0.3s ease-in-out; overflow-y: auto; }
Â  Â  Â  Â  .sidebar.hidden { width: 0; opacity: 0; padding: 0; pointer-events: none; }
Â  Â  Â  Â  .sidebar-header .company-logo { position: static; width: 80%; margin: 0 auto 30px auto; display: block; }
Â  Â  Â  Â  #main-nav { flex-grow: 1; overflow-y: auto; margin-bottom: 20px; }
Â  Â  Â  Â  #main-nav ul { list-style-type: none; padding: 0; margin: 0; }
Â  Â  Â  Â  #main-nav li a { display: block; padding: 15px 20px; color: #e0e0e0; text-decoration: none; border-radius: 8px; margin-bottom: 5px; font-weight: 500; transition: all 0.2s ease; cursor: pointer; position: relative; background-color: transparent; }
Â  Â  Â  Â  #main-nav li a:hover { background-color: rgba(255, 255, 255, 0.1); color: white; transform: translateY(-2px); box-shadow: 0 4px 8px rgba(0,0,0,0.2); }
Â  Â  Â  Â  #main-nav li a.active { background-color: #ffffff; color: #1e3a5f; box-shadow: 0 4px 8px rgba(0,0,0,0.2); transform: translateY(-2px); }
Â  Â  Â  Â  .content-area { flex-grow: 1; padding: 40px; overflow-y: auto; background-color: #f4f7fa; transition: padding-left 0.3s ease-in-out; position: relative; }
Â  Â  Â  Â  .content-area.fullscreen { padding: 0; overflow: hidden; display: flex; justify-content: center; align-items: center; }
Â  Â  Â  Â  .content-header { margin-bottom: 30px; display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 15px;}
Â  Â  Â  Â  .content-header h1 { font-size: 2.2rem; color: #1e3a5f; margin: 0; }
Â  Â  Â  Â  .content-header p { font-size: 1.1rem; color: #5a718c; margin: 0; }
Â  Â  Â  Â  .btn-primary { background-color: #007bff; color: white; padding: 10px 20px; border-radius: 6px; border: none; font-size: 1rem; font-weight: 600; cursor: pointer; transition: background-color 0.2s; }
Â  Â  Â  Â  .btn-primary:hover { background-color: #0069d9; }
Â  Â  Â  Â  .btn-secondary { background-color: #6c757d; color: white; padding: 10px 20px; border-radius: 6px; border: none; font-size: 1rem; font-weight: 600; cursor: pointer; transition: background-color 0.2s; }
Â  Â  Â  Â  .btn-secondary:hover { background-color: #5a6268; }
Â  Â  Â  Â  .sidebar-footer { margin-top: auto; padding-top: 20px; border-top: 1px solid rgba(255,255,255,0.2); flex-shrink: 0; }
Â  Â  Â  Â  #btn-adicionar-contrato { width: 100%; padding: 15px; background-color: #4caf50; color: white; border: none; border-radius: 8px; font-family: 'Poppins', sans-serif; font-size: 1rem; font-weight: 600; cursor: pointer; transition: background-color 0.2s ease; }
Â  Â  Â  Â  #btn-adicionar-contrato:hover { background-color: #45a049; }
Â  Â  Â  Â  .danger-zone { margin-top: 30px; padding-top: 20px; border-top: 1px solid #e0e0e0; }
Â  Â  Â  Â  .danger-zone h3 { color: #c82333; }
Â  Â  Â  Â  #btn-excluir-contrato { background-color: #c82333; color: white; padding: 10px 20px; border: none; border-radius: 6px; cursor: pointer; font-weight: 600; transition: background-color 0.2s ease; }
Â  Â  Â  Â  #btn-excluir-contrato:hover { background-color: #a51c29; }
Â  Â  Â  Â  .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.6); justify-content: center; align-items: center; }
Â  Â  Â  Â  .modal.active { display: flex; }
Â  Â  Â  Â  .modal-content { background-color: #fff; width: 90%; max-width: 700px; border-radius: 12px; box-shadow: 0 5px 15px rgba(0,0,0,0.3); display: flex; flex-direction: column; max-height: 90vh; }
Â  Â  Â  Â  .modal-header { display: flex; justify-content: space-between; align-items: center; padding: 15px 25px; border-bottom: 1px solid #e5e5e5; }
Â  Â  Â  Â  .modal-header h2 { margin: 0; color: #1e3a5f; }
Â  Â  Â  Â  .close-button { border: none; background: none; font-size: 2.5rem; cursor: pointer; color: #aaa; line-height: 1; padding: 0; }
Â  Â  Â  Â  .close-button:hover { color: #333; }
Â  Â  Â  Â  .modal-body { padding: 25px; overflow-y: auto; }
Â  Â  Â  Â  .form-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
Â  Â  Â  Â  .form-group { margin-bottom: 15px; }
Â  Â  Â  Â  .form-group.full-width { grid-column: 1 / -1; }
Â  Â  Â  Â  .form-group label { display: block; margin-bottom: 5px; font-weight: 600; color: #333; }
Â  Â  Â  Â  .form-group input, .form-group select, .form-group textarea { width: 100%; padding: 12px; font-size: 1rem; border: 1px solid #ccc; border-radius: 6px; font-family: 'Poppins', sans-serif; }
Â  Â  Â  Â  .form-group input:read-only, .form-group textarea:read-only, input:read-only { background-color: #e9ecef; opacity: 1; cursor: not-allowed; }
Â  Â  Â  Â  textarea { resize: vertical; min-height: 80px; }
Â  Â  Â  Â  fieldset { border: 1px solid #ccc; border-radius: 6px; padding: 15px; margin-top: 20px; grid-column: 1 / -1; }
Â  Â  Â  Â  legend { font-weight: 600; color: #1e3a5f; padding: 0 10px; }
Â  Â  Â  Â  .modal-footer { display: flex; justify-content: flex-end; gap: 10px; padding: 15px 25px; border-top: 1px solid #e5e5e5; background-color: #f9f9f9; border-bottom-left-radius: 12px; border-bottom-right-radius: 12px; }
Â  Â  Â  Â  .cs-controls { display: flex; align-items: center; gap: 20px; margin-bottom: 20px; background-color: #fff; padding: 15px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); flex-wrap: wrap; }
Â  Â  Â  Â  .cs-controls input, .cs-controls select { padding: 10px; border: 1px solid #ccc; border-radius: 6px; font-size: 1rem; }
Â  Â  Â  Â  .cs-table-wrapper { overflow-x: auto; background-color: #fff; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); }
Â  Â  Â  Â  .cs-table { width: 100%; border-collapse: collapse; min-width: 800px; }
Â  Â  Â  Â  .cs-table th, .cs-table td { padding: 12px 15px; text-align: left; border-bottom: 1px solid #e0e0e0; }
Â  Â  Â  Â  .cs-table th { font-weight: 600; color: #1e3a5f; background-color: #f8faff; white-space: nowrap; }
Â  Â  Â  Â  .cs-table tr:last-child td { border-bottom: none; }
Â  Â  Â  Â  .cs-table tr:hover { background-color: #f4f7fa; }
Â  Â  Â  Â  .status-badge { padding: 4px 8px; border-radius: 12px; color: white; font-weight: 600; font-size: 0.8rem; text-align: center; }
Â  Â  Â  Â  .status-badge.pendente { background-color: #ffc107; color: #333; }
Â  Â  Â  Â  .status-badge.respondido { background-color: #28a745; }
Â  Â  Â  Â  .status-badge.atrasado { background-color: #dc3545; }
Â  Â  Â  Â  .prazo-atencao { color: #ff9800; font-weight: 700; }
Â  Â  Â  Â  .prazo-vencido { color: #dc3545; font-weight: 700; }
Â  Â  Â  Â  .actions-cell { display: flex; gap: 10px; }
Â  Â  Â  Â  .actions-cell button { background: none; border: none; cursor: pointer; font-size: 1.2rem; padding: 5px; }
Â  Â  Â  Â  .dashboard-grid { display: grid; grid-template-columns: 1fr; gap: 30px; }
Â  Â  Â  Â  .metrics { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 20px; text-align: center; }
Â  Â  Â  Â  .metric-card { background-color: #ffffff; padding: 20px; border-radius: 12px; border: 1px solid #dbe3f0; box-shadow: 0 4px 12px rgba(0,20,60,0.05); }
Â  Â  Â  Â  .metric-card .label { font-size: 0.9rem; color: #5a718c; margin-bottom: 8px; }
Â  Â  Â  Â  .metric-card .value { font-size: 2.2rem; font-weight: 700; color: #007bff; }
Â  Â  Â  Â  .metric-card .value.goal { color: #28a745; }
Â  Â  Â  Â  .progress-card { text-align: left; }
Â  Â  Â  Â  .input-area { display: flex; align-items: center; gap: 5px; margin-bottom: 10px; }
Â  Â  Â  Â  .progress-card label { font-weight: 600; color: #1e3a5f; white-space: nowrap; margin-right: 10px;}
Â  Â  Â  Â  .input-wrapper { position: relative; flex-grow: 1; }
Â  Â  Â  Â  .input-wrapper .currency-symbol { position: absolute; left: 12px; top: 50%; transform: translateY(-50%); font-size: 1rem; color: #5a718c; font-weight: 600; }
Â  Â  Â  Â  .progress-card input { width: 100%; padding: 10px 10px 10px 35px; font-size: 1rem; font-family: 'Poppins', sans-serif; border: 2px solid #cdd7e5; border-radius: 8px; outline: none; transition: all 0.2s; }
Â  Â  Â  Â  input.no-symbol { padding: 10px 15px !important; }
Â  Â  Â  Â  input:focus { border-color: #007bff; box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.2); }
Â  Â  Â  Â  .progress-bar-container { background-color: #e9ecef; border-radius: 8px; height: 25px; margin-bottom: 15px; overflow: hidden; }
Â  Â  Â  Â  .progress-bar-fill { background-color: #28a745; height: 100%; width: 0%; border-radius: 8px; display: flex; align-items: center; justify-content: center; color: white; font-weight: 600; font-size: 0.9rem; transition: width 0.5s ease-in-out; }
Â  Â  Â  Â  .progress-details { display: flex; justify-content: space-between; font-size: 0.9rem; color: #5a718c; }
Â  Â  Â  Â  .progress-details span { font-weight: 600; color: #333; }
Â  Â  Â  Â  .goal-surpassed { color: #28a745; font-weight: 700; }
Â  Â  Â  Â  .progress-bar-sewage { height: 35px; border-radius: 17px; background-color: #e9ecef; margin-bottom: 15px; overflow: hidden; position: relative; display: flex; align-items: center; justify-content: flex-start; }
Â  Â  Â  Â  .progress-bar-sewage::before { content: 'ğŸ '; font-size: 1.8rem; position: absolute; left: 5px; top: 50%; transform: translateY(-50%); z-index: 2; }
Â  Â  Â  Â  .progress-bar-sewage::after { content: 'ğŸ­'; font-size: 1.8rem; position: absolute; right: 5px; top: 50%; transform: translateY(-50%); z-index: 2; }
Â  Â  Â  Â  .progress-bar-fill-sewage { height: 100%; background-color: #007bff; border-radius: 17px; display: flex; align-items: center; justify-content: center; color: white; font-weight: 600; font-size: 0.9rem; transition: width 0.5s ease-in-out; }
Â  Â  Â  Â  .slideshow-wrapper { width: 100%; height: 100%; display: flex; flex-direction: column; justify-content: flex-start; align-items: stretch; position: relative; }
Â  Â  Â  Â  .content-area.fullscreen .slideshow-wrapper { justify-content: center; }
Â  Â  Â  Â  .slideshow-header { display: flex; justify-content: space-between; align-items: center; padding-bottom: 20px; margin-bottom: 20px; border-bottom: 1px solid #e0e0e0; }
Â  Â  Â  Â  .content-area.fullscreen .slideshow-header { display: none; }
Â  Â  Â  Â  .slideshow-header h1 { margin: 0; font-size: 2.2rem; color: #1e3a5f; }
Â  Â  Â  Â  .fullscreen-button { background: none; border: none; font-size: 1.8rem; cursor: pointer; color: #5a718c; padding: 0; line-height: 1; transition: color 0.2s ease; }
Â  Â  Â  Â  .fullscreen-button:hover { color: #1e3a5f; }
Â  Â  Â  Â  .exit-fullscreen-button { display: none; position: absolute; top: 20px; right: 20px; background-color: rgba(0,0,0,0.6); color: white; border: none; padding: 10px 15px; border-radius: 8px; cursor: pointer; z-index: 1001; font-size: 1rem; }
Â  Â  Â  Â  .content-area.fullscreen .exit-fullscreen-button { display: block; }
Â  Â  Â  Â  .slideshow-content { flex-grow: 1; display: grid; position: relative; max-width: 1200px; width: 100%; margin: 0 auto; }
Â  Â  Â  Â  .content-area.fullscreen .slideshow-content { height: 100%; max-height: 90vh; display: grid; align-content: center; }
Â  Â  Â  Â  .panel-slide {
Â  Â  Â  Â  Â  Â  grid-column-start: 1; grid-row-start: 1; opacity: 0; visibility: hidden;
Â  Â  Â  Â  Â  Â  transition: opacity 0.7s ease-in-out, visibility 0.7s;
Â  Â  Â  Â  Â  Â  background-color: white; border-radius: 12px; padding: 30px;
Â  Â  Â  Â  Â  Â  box-shadow: 0 8px 20px rgba(0,0,0,0.1);
Â  Â  _**
Â  Â  Â  Â  Â  Â  display: flex; flex-direction: column; gap: 25px; width: 100%;
Â  Â  Â  Â  }
Â  Â  Â  Â  .panel-slide.active { opacity: 1; visibility: visible; }
Â  Â  Â  Â  .panel-slide h2 { font-size: 2rem; color: #1e3a5f; margin: 0 0 20px 0; text-align: center; }
Â  Â  Â  Â  .panel-slide .progress-bar-container { height: 40px; border-radius: 20px; margin-bottom: 20px; }
Â  Â  Â  Â  .panel-slide .progress-bar-fill, .panel-slide .progress-bar-fill-sewage { border-radius: 20px; font-size: 1.1rem; font-weight: 700; }
Â  Â  Â  Â  .panel-slide .progress-details { font-size: 1.1rem; font-weight: 500; color: #5a718c; display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; }
Â  Â  Â  Â  .panel-slide .progress-details div { padding: 10px 0; border-radius: 8px; background-color: #f8fafd; text-align: center; box-shadow: inset 0 1px 3px rgba(0,0,0,0.05); }
Â  Â  Â  Â  .panel-slide .progress-details span { font-weight: 700; color: #1e3a5f; display: block; font-size: 1.4rem; }
Â  Â  Â  Â  .panel-slide .progress-details div .goal-surpassed { color: #28a745 !important; }
Â  Â  Â  Â  .panel-slide .progress-details div:first-child span { color: #c82333; }
Â  Â  Â  Â  .panel-slide .progress-details div:nth-child(2) span { color: #007bff; }
Â  Â  Â  Â  .panel-slide .progress-details div:nth-child(3) span { color: #28a745; }
Â  Â  Â  Â  .panel-slide .progress-details div:nth-child(4) span { color: #6f42c1; }
Â  Â  Â  Â  .calendars { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 15px; margin-top: 20px; padding: 10px; background: #f8fafd; border-radius: 8px;}
Â  Â  Â  Â  #calendars-avance { max-height: 400px; overflow-y: auto; }
Â  Â  Â  Â  .month { background-color: #fff; border-radius: 10px; padding: 15px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); }
Â  Â  Â  Â  .month h3 { text-align: center; font-size: 1.3rem; color: #1e3a5f; margin-bottom: 15px; }
Â  Â  Â  Â  .calendar-grid { display: grid; grid-template-columns: 30px repeat(7, 1fr); gap: 5px; }
Â  Â  Â  Â  .day-name { font-weight: 600; color: #5a718c; font-size: 0.85rem; text-align: center; padding: 8px 0; }
Â  Â  Â  Â  .week-number-header { grid-column: 1; }
Â  Â  Â  Â  .week-number { display: flex; align-items: center; justify-content: center; font-size: 0.8rem; font-weight: 600; color: #6f42c1; background-color: #f4f1fa; border-radius: 6px; }
Â  Â  Â  Â  .day { border-radius: 6px; display: flex; flex-direction: column; align-items: center; justify-content: center; height: 45px; position: relative; }
Â  Â  Â  Â  .day-of-month { font-size: 0.7rem; color: #6c757d; }
Â  Â  Â  Â  .day.weekend { background-color: #f1f3f5; }
Â  Â  Â  Â  .day.past-day { background-color: #e9ecef; color: #ced4da; text-decoration: line-through; font-weight: 600; }
Â  Â  Â  Â  .day.today { background-color: #fff3cd; border: 2px solid #ffeeba; }
Â  Â  Â  Â  .day.end-date { background-color: #007bff; color: white; }
Â  Â  Â  Â  .day.end-date::after { content: 'ğŸ¯'; position: absolute; top: -5px; right: -5px; font-size: 1rem; }
Â  Â  Â  Â  .empty-day { visibility: hidden; }
Â  Â  Â  Â  .day.future-workday { background-color: #eaf6ff; }
Â  Â  Â  Â  .day.holiday { background-color: #fdeaea; }

Â  Â  Â  Â  .sidebar-toggle {
Â  Â  Â  Â  Â  Â  display: none;Â 
Â  Â  Â  Â  Â  Â  position: fixed;
Â  Â  Â  Â  Â  Â  top: 15px;
Â  Â  Â  Â  Â  Â  left: 15px;
Â  Â  Â  Â  Â  Â  z-index: 999;
Â  Â  Â  Â  Â  Â  width: 40px;
Â  Â  Â  Â  Â  Â  height: 40px;
Â  Â  Â  Â  Â  Â  background: #1e3a5f;
Â  Â  Â  Â  Â  Â  border: none;
Â  Â  Â  Â  Â  Â  border-radius: 8px;
Â  Â  Â  Â  Â  Â  padding: 8px;
Â  Â  Â  Â  Â  Â  cursor: pointer;
Â  Â  Â  Â  Â  Â  box-shadow: 0 4px 10px rgba(0,0,0,0.2);
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  flex-direction: column;
Â  Â  Â  Â  Â  Â  justify-content: space-around;
Â  Â  Â  Â  }
Â  Â  Â  Â  .sidebar-toggle span {
Â  Â  Â  Â  Â  Â  display: block;
Â  Â  Â  Â  Â  Â  width: 100%;
Â  Â  Â  Â  Â  Â  height: 3px;
Â  Â  Â  Â  Â  Â  background: white;
Â  Â  Â  Â  Â  Â  border-radius: 2px;
Â  Â  Â  Â  Â  Â  transition: all 0.3s;
Â  Â  Â  Â  }
Â  Â  Â  Â  .sidebar.is-open + .sidebar-toggle span:nth-child(1) {
Â  Â  Â  Â  Â  Â  transform: translateY(7px) rotate(45deg);
Â  Â  Â  Â  }
Â  Â  Â  Â  .sidebar.is-open + .sidebar-toggle span:nth-child(2) {
Â  Â  Â  Â  Â  Â  opacity: 0;
Â  Â  Â  Â  }
Â  Â  Â  Â  .sidebar.is-open + .sidebar-toggle span:nth-child(3) {
Â  Â  Â  Â  Â  Â  transform: translateY(-7px) rotate(-45deg);
Â  Â  Â  Â  }

Â  Â  Â  Â  .sidebar-overlay {
Â  Â  Â  Â  Â  Â  display: none;
Â  Â  Â  Â  Â  Â  position: fixed;
Â  Â  Â  Â  Â  Â  top: 0; left: 0; right: 0; bottom: 0;
Â  Â  Â  Â  Â  Â  background: rgba(0,0,0,0.5);
Â  Â  Â  Â  Â  Â  z-index: 997;
Â  Â  Â  Â  }
Â  Â  Â  Â  .sidebar-overlay.is-open {
Â  Â  Â  Â  Â  Â  display: block;
Â  Â  Â  Â  }

Â  Â  Â  Â  @media (max-width: 768px) {
Â  Â  Â  Â  Â  Â  body, html {
Â  Â  Â  Â  Â  Â  Â  Â  overflow-y: auto;Â 
Â  Â  Â  Â  Â  Â  Â  Â  overflow-x: hidden;
Â  _**
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  .sidebar-toggle {
Â  Â  Â  Â  Â  Â  Â  Â  display: flex;Â 
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  .system-container {
Â  Â  Â  Â  Â  Â  Â  Â  flex-direction: column;Â 
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  .sidebar {
Â  Â  Â  _**
Â  Â  Â  Â  Â  Â  Â  Â  position: fixed;Â 
Â  Â  Â  Â  Â  Â  Â  Â  left: -300px;Â 
Â  Â  Â  Â  Â  Â  Â  Â  width: 280px;Â 
Â  Â  Â  Â  Â  Â  Â  Â  height: 100vh;
Â  Â  Â  Â  Â  Â  Â  Â  z-index: 998;
Â  Â  Â  Â  Â  Â  Â  Â  transition: left 0.3s ease-in-out;
Â  Â  Â  Â  Â  Â  Â  Â  box-shadow: 4px 0 15px rgba(0,0,0,0.2);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  .sidebar.is-open {
Â  Â  Â  Â  Â  Â  Â  Â  left: 0;Â 
Â  Â  Â  _**
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  .sidebar.hidden {
Â  Â  Â  Â  Â  Â  Â  Â  left: -300px !important;
Â  Â  Â  Â  Â  Â  Â  Â  width: 0;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  .content-area {
Â  Â  Â  Â  Â  Â  Â  Â  padding: 20px;
Â  Â  Â  Â  Â  Â  Â  Â  padding-top: 70px;Â 
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  .content-header h1 {
Â  Â  Â  Â  Â  Â  Â  Â  font-size: 1.8rem;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  .form-grid {
Â  Â  Â  Â  Â  Â  Â  Â  grid-template-columns: 1fr;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  .form-group.full-width {
Â  Â  Â  Â  Â  Â  Â  Â  grid-column: 1 / 1;Â 
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  fieldset {
Â  Â  Â  Â  Â  Â  Â  Â  Â grid-column: 1 / 1;Â 
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  .metrics {
Â  Â  Â  Â  Â  Â  Â  Â  grid-template-columns: 1fr;Â 
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  .panel-slide {
Â  Â  Â  Â  Â  Â  Â  Â  padding: 20px;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  .panel-slide .progress-details {
Â  Â  Â  Â  Â  Â  Â  Â  grid-template-columns: 1fr;Â 
Â  Â  Â  Â  Â  Â  Â  Â  gap: 10px;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  .panel-slide h2 {
Â  Â  Â  Â  Â  Â  Â  Â  font-size: 1.5rem;Â 
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  </style>
</head>
<body>

Â  Â  <button id="sidebar-toggle-btn" class="sidebar-toggle" aria-label="Abrir menu" aria-expanded="false">
Â  Â  Â  Â  <span></span>
Â  Â  Â  Â  <span></span>
Â  Â  Â  Â  <span></span>
Â  Â  </button>
Â  Â  <div id="sidebar-overlay" class="sidebar-overlay"></div>

Â  Â  <div class="system-container">
Â  Â  Â  Â  <aside class="sidebar">
Â  Â  Â  Â  Â  Â  <header class="sidebar-header"><img src="imagem2.png" alt="Logo da Empresa" class="company-logo"></header>
Â  Â  Â  Â  Â  Â  <nav id="main-nav"><ul></ul></nav>
Â  Â  Â  Â  Â  Â  <div class="sidebar-footer"><button id="btn-adicionar-contrato">+ Adicionar Novo Contrato</button></div>
Â  Â  Â  Â  </aside>
Â  Â  Â  Â  <main id="content-area" class="content-area">
Â  Â  Â  Â  Â  Â  <div class="welcome-message"><h1>Carregando...</h1><p>Buscando dados mais recentes.</p></div>
Â  Â  Â  Â  </main>
Â  Â  </div>

Â  Â  <div id="modal-novo-contrato" class="modal">
Â  Â  Â  Â  <div class="modal-content">
Â  Â  Â  Â  Â  Â  <div class="modal-header">
Â  Â  Â  Â  Â  Â  Â  Â  <h2>Adicionar Novo Contrato</h2>
Â  Â  Â  Â  Â  Â  Â  Â  <button class="close-button">&times;</button>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <form id="form-novo-contrato">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="modal-body">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="form-grid">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="form-group"><label for="nome-curto">Nome Curto (Menu):</label><input type="text" id="nome-curto" required></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="form-group"><label for="nome-completo">Nome Completo (TÃ­tulo):</label><input type="text" id="nome-completo" required></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <fieldset>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <legend>Metas</legend>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="form-grid">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="form-group"><label for="meta-imob">Meta ImobilizaÃ§Ã£o (R$):</label><input type="number" id="meta-imob" step="0.01" min="0"></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="form-group"><label for="meta-econ">Meta Economias:</label><input type="number" id="meta-econ" min="0"></div>
Â  Â  Â  Â  _**
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="form-group"><label for="meta-avance">Meta AvanÃ§o FÃ­sico (m):</label><input type="number" id="meta-avance" min="0"></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  _**
Â  Â  Â  Â  Â  Â  Â  Â  Â  </fieldset>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="modal-footer">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button type="button" class="btn-secondary close-button">Cancelar</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button type="submit" class="btn-primary">Salvar Contrato</button>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </form>
Â  Â  Â  Â  </div>
Â  Â  </div>
Â  Â Â 
Â  Â  <div id="modal-comuniquese" class="modal">
Â  Â  Â  Â  <div class="modal-content">
Â  Â  Â  Â  Â  Â  <div class="modal-header">
Â  Â  Â  Â  Â  Â  Â  Â  <h2 id="modal-cs-title">Novo Comunique-se</h2>
Â  Â  Â  Â  Â  Â  Â  Â  <button class="close-button">&times;</button>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <form id="form-comuniquese">
Â  Â  Â  Â  Â  Â  Â  Â  <input type="hidden" id="cs-id">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="modal-body">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="form-grid">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="form-group"><label for="cs-protocolo">Protocolo:</label><input type="text" id="cs-protocolo" required></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="form-group"><label for="cs-orgao">Ã“rgÃ£o Emissor:</label><input type="text" id="cs-orgao" required></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="form-group"><label for="cs-data-recebimento">Data Recebimento:</label><input type="date" id="cs-data-recebimento" required></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="form-group"><label for="cs-prazo-dias">Prazo (Dias):</label><input type="number" id="cs-prazo-dias" min="1" required></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="form-group full-width"><label for="cs-assunto">Assunto:</label><textarea id="cs-assunto" rows="2"></textarea></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="form-group"><label for="cs-responsavel">ResponsÃ¡vel:</label><input type="text" id="cs-responsavel"></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="form-group"><label for="cs-status">Status:</label><select id="cs-status"><option value="Pendente">Pendente</option><option value="Respondido">Respondido</option></select></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="form-group"><label for="cs-data-resposta">Data Resposta:</label><input type="date" id="cs-data-resposta"></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="form-group"><label for="cs-oficio-resposta">OfÃ­cio Resposta:</label><input type="text" id="cs-oficio-resposta"></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="form-group full-width"><label for="cs-observacao">ObservaÃ§Ã£o:</label><textarea id="cs-observacao" rows="3"></textarea></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="modal-footer">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button type="button" class="btn-secondary close-button">Cancelar</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button type="submit" class="btn-primary">Salvar</button>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </form>
Â  Â  Â  Â  </div>
Â  Â  </div>

Â  Â  <script>
Â  Â  // ======================================================================================================
Â  Â  // SCRIPT COMPLETO (v12 - Removido "Casas" + Responsivo + Modo de EdiÃ§Ã£o + "Economias" nas metas)
Â  Â  // ======================================================================================================
Â  Â  /**
Â  Â  * @author ERIVANDRO JUNIOR
Â  Â  */

Â  Â  let isAdmin = false;

Â  Â  document.addEventListener('DOMContentLoaded', () => {

Â  Â  Â  Â  const urlParams = new URLSearchParams(window.location.search);
Â  Â  Â  Â  isAdmin = urlParams.get('modo') === 'edicao';Â 

Â  Â  Â  Â  const JSONBIN_URL = 'https://api.jsonbin.io/v3/b/68e8e81ad0ea881f409c51f0';Â 
Â  Â  Â  Â  const API_KEY = '$2a$10$L4n/qlQ8LGkgQmd9p7zhaOAK6j5pgA.2Tq7xK019hUqDGNfPmqJ5O';Â 

Â  Â  Â  Â  let database = { obras: [], comuniqueses: [] };
Â  Â  Â  Â  let slideshowInterval = null;
Â  Â  Â  Â  let currentSlide = 0;
Â  Â  Â  Â  let slides = [];
Â  Â  Â  Â  const navList = document.querySelector('#main-nav ul');
Â  Â  Â  Â  const contentArea = document.getElementById('content-area');
Â  Â  Â  Â  const sidebar = document.querySelector('.sidebar');
Â  Â  Â  Â Â 
Â  Â  Â  Â  const formatCurrency = (v) => (v || 0).toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
Â  Â  Â  Â  const formatUnits = (v, u = '') => `${(Math.round(v) || 0).toLocaleString('pt-BR')} ${u}`.trim();
Â  Â  Â  Â  const formatAsCompactCurrency = (v) => (v >= 1e6 ? `R$ ${(v / 1e6).toFixed(1).replace('.', ',')} mi` : (v >= 1e3 ? `R$ ${(v / 1e3).toFixed(1).replace('.', ',')} mil` : formatCurrency(v)));
Â  Â  Â  Â  const calculatePercentage = (c, g) => (g > 0 ? (c / g) * 100 : 0);
Â  Â  Â  Â  const formatarValorFaltante = (m, a, t, u = '', d = 1) => { const diff = m - a; if (diff <= 0) { const s = Math.abs(diff); let vf; if (t === 'currency') vf = formatCurrency(s); else vf = formatUnits(s / d, u); return `Superamos a meta em <span class="goal-surpassed">${vf}</span>`; } else { let vf; if (t === 'currency') vf = formatCurrency(diff); else vf = formatUnits(diff / d, u); return `Faltam: <span>${vf}</span>`; } };
Â  Â  Â  Â  function getBusinessDaysBetween(startDate, endDate, holidays) { let count = 0; const curDate = new Date(Date.UTC(startDate.getUTCFullYear(), startDate.getUTCMonth(), startDate.getUTCDate())); const lastDate = new Date(Date.UTC(endDate.getUTCFullYear(), endDate.getUTCMonth(), endDate.getUTCDate())); const holidaySet = new Set(holidays); while (curDate <= lastDate) { const dayOfWeek = curDate.getUTCDay(); const isoDate = curDate.toISOString().split('T')[0]; if (dayOfWeek !== 0 && dayOfWeek !== 6 && !holidaySet.has(isoDate)) { count++; } curDate.setUTCDate(curDate.getUTCDate() + 1); } return count; }

Â  Â  Â  Â  function gerarNavegacao(obras) { const activeId = navList.querySelector('a.active')?.dataset.id || 'painel-tv'; navList.innerHTML = ''; navList.innerHTML += `<li><a data-id="painel-tv" title="Painel TV">ğŸ“º Painel TV</a></li>`; navList.innerHTML += `<li><a data-id="visao-geral">VisÃ£o Geral</a></li>`; navList.innerHTML += `<li><a data-id="comuniqueses">ğŸ“„ Comunique-se</a></li>`; 
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  // [NOVA ALTERAÃ‡ÃƒO] Adiciona o botÃ£o de LanÃ§ar HistÃ³rico (somente para admin)
Â  Â  Â  Â  Â  Â  if (isAdmin) {
Â  Â  Â  Â  Â  Â  Â  Â  // Usamos uma cor diferente para destacar que Ã© uma ferramenta de admin
Â  Â  Â  Â  Â  Â  Â  Â  navList.innerHTML += `<li><a data-id="lancar-historico" style="color: #ffc107; font-weight: 600;">ğŸ› ï¸ LanÃ§ar HistÃ³rico</a></li>`;
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  obras.sort((a, b) => a.nomeCurto.localeCompare(b.nomeCurto)).forEach(o => { navList.innerHTML += `<li><a data-id="${o.id}">${o.nomeCurto}</a></li>`; }); const linkAtivo = navList.querySelector(`a[data-id="${activeId}"]`) || navList.querySelector('a'); if (linkAtivo) linkAtivo.classList.add('active'); navList.querySelectorAll('a').forEach(l => l.addEventListener('click', handleNavClick)); }
Â  Â  Â  Â Â 
Â  Â  Â  Â  function mostrarVisaoGeral(obras) {Â 
Â  Â  Â  Â  Â  Â  const tImobM = obras.reduce((s, o) => s + o.dadosImobilizacao.meta, 0), tImobA = obras.reduce((s, o) => s + o.dadosImobilizacao.atual, 0), tEconM = obras.reduce((s, o) => s + o.dadosEconomia.meta, 0), tEconA = obras.reduce((s, o) => s + o.dadosEconomia.atual, 0), tAvanceM = obras.reduce((s, o) => s + o.dadosAvanceFisico.meta, 0), tAvanceA = obras.reduce((s, o) => s + o.dadosAvanceFisico.atual, 0);Â 
Â  Â  Â  Â  Â  Â  const pImob = calculatePercentage(tImobA, tImobM), pEcon = calculatePercentage(tEconA, tEconM), pAvance = calculatePercentage(tAvanceA, tAvanceM);Â 
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // [ALTERAÃ‡ÃƒO] Removido 'casas'
Â  Â  Â  Â  Â  Â  // [ALTERAÃ‡ÃƒO] Adicionado 'economias' na funÃ§Ã£o formatarValorFaltante para Economias
Â  Â  Â  Â  Â  Â  contentArea.innerHTML = `<div class="content-header"><div><h1>VisÃ£o Geral do Projeto</h1><p>Resumo de todos os contratos.</p></div></div><div class="dashboard-grid"><section class="metrics"><figure class="metric-card"><figcaption class="label">Contratos Ativos</figcaption><div class="value">${obras.length}</div></figure><figure class="metric-card"><figcaption class="label">ImobilizaÃ§Ã£o Total</figcaption><div class="value goal">${formatAsCompactCurrency(tImobM)}</div></figure><figure class="metric-card"><figcaption class="label">Economias Totais</figcaption><div class="value goal">${formatUnits(tEconM)}</div></figure><figure class="metric-card"><figcaption class="label">ExtensÃ£o Total</figcaption><div class="value goal">${formatUnits(tAvanceM / 1e3, 'km')}</div></figure></section><section class="metric-card progress-card"><h3>Progresso: ImobilizaÃ§Ã£o</h3><div class="progress-bar-container"><div class="progress-bar-fill" style="width:${pImob > 100 ? 100 : pImob.toFixed(2)}%;">${pImob.toFixed(1).replace('.', ',')}%</div></div><div class="progress-details"><div>${formatarValorFaltante(tImobM, tImobA, 'currency')}</div><div>Executado: <span>${formatCurrency(tImobA)}</span></div></div></section><section class="metric-card progress-card"><h3>Progresso: Economias</h3><div class="progress-bar-container"><div class="progress-bar-fill" style="width:${pEcon > 100 ? 100 : pEcon.toFixed(2)}%;background-color:#ff9800;">${pEcon.toFixed(1).replace('.', ',')}%</div></div><div class="progress-details"><div>${formatarValorFaltante(tEconM, tEconA, 'units', 'economias')}</div><div>AlcanÃ§ado: <span>${formatUnits(tEconA)}</span></div></div></section><section class="metric-card progress-card"><h3>Progresso: AvanÃ§o FÃ­sico</h3><div class="progress-bar-sewage"><div class="progress-bar-fill-sewage" style="width:${pAvance > 100 ? 100 : pAvance.toFixed(2)}%;">${pAvance.toFixed(1).replace('.', ',')}%</div></div><div class="progress-details"><div>${formatarValorFaltante(tAvanceM, tAvanceA, 'units', 'km', 1e3)}</div><div>Executado: <span>${formatUnits(tAvanceA / 1e3, 'km')}</span></div></div></section></div>`;Â 
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  function mostrarPaginaObra(o) {
Â  Â  Â  Â  Â  Â  const pI = calculatePercentage(o.dadosImobilizacao.atual, o.dadosImobilizacao.meta), pE = calculatePercentage(o.dadosEconomia.atual, o.dadosEconomia.meta), pA = calculatePercentage(o.dadosAvanceFisico.atual, o.dadosAvanceFisico.meta);
Â  Â  Â  Â  Â  Â  const vIf = (o.dadosImobilizacao.atual || 0).toLocaleString('pt-BR', { minimumFractionDigits: 2 });
Â  Â  Â  Â  Â  Â  const readOnlyState = !isAdmin ? 'readonly' : '';
Â  Â  Â  Â  Â  Â  const adminOnlyDisplay = !isAdmin ? 'style="display:none;"' : '';
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // [ALTERAÃ‡ÃƒO] Removido "(Casas)" e "Casas Atendidas"
Â  Â  Â  Â  Â  Â  // [ALTERAÃ‡ÃƒO] Adicionado 'economias' na funÃ§Ã£o formatarValorFaltante para Economias
Â  Â  Â  Â  Â  Â  contentArea.innerHTML = `
Â  Â  Â  Â  Â  Â  <div class="content-header"><div><h1>${o.nomeCompleto}</h1><p>Acompanhamento detalhado.</p></div></div>
Â  Â  Â  Â  Â  Â  <div class="dashboard-grid">
Â  Â  Â  Â  Â  Â  Â  Â  <section class="metric-card progress-card">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h3>ImobilizaÃ§Ã£o Financeira</h3>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="input-area">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label for="input-imob">Valor Realizado:</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="input-wrapper"><span class="currency-symbol">R$</span><input type="text" id="input-imob" data-obra-id="${o.id}" data-tipo="imobilizacao" value="${vIf}" ${readOnlyState}></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="progress-bar-container"><div class="progress-bar-fill" style="width:${pI > 100 ? 100 : pI.toFixed(2)}%;">${pI.toFixed(1).replace('.', ',')}%</div></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="progress-details">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div>${formatarValorFaltante(o.dadosImobilizacao.meta, o.dadosImobilizacao.atual, 'currency')}</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div>Meta: <span>${formatCurrency(o.dadosImobilizacao.meta)}</span></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  </section>
Â  Â  Â  Â  Â  Â  Â  Â  <section class="metric-card progress-card">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h3>Economias</h3>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="input-area">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label for="input-econ">Economias Atendidas:</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="input-wrapper"><input type="text" id="input-econ" class="no-symbol" data-obra-id="${o.id}" data-tipo="economia" value="${(o.dadosEconomia.atual || 0).toLocaleString('pt-BR')}" ${readOnlyState}></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="progress-bar-container"><div class="progress-bar-fill" style="width:${pE > 100 ? 100 : pE.toFixed(2)}%;background-color:#ff9800;">${pE.toFixed(1).replace('.', ',')}%</div></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="progress-details">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div>${formatarValorFaltante(o.dadosEconomia.meta, o.dadosEconomia.atual, 'units', 'economias')}</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div>Meta: <span>${formatUnits(o.dadosEconomia.meta)}</span></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  </section>
Â  Â  Â  Â  Â  Â  Â  Â  <section class="metric-card progress-card">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h3>AvanÃ§o FÃ­sico (m)</h3>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="input-area">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label for="input-avance">Metros Executados:</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="input-wrapper"><input type="text" id="input-avance" class="no-symbol" data-obra-id="${o.id}" data-tipo="avance" value="${(o.dadosAvanceFisico.atual || 0).toLocaleString('pt-BR')}" ${readOnlyState}></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="progress-bar-sewage"><div class="progress-bar-fill-sewage" style="width:${pA > 100 ? 100 : pA.toFixed(2)}%;">${pA.toFixed(1).replace('.', ',')}%</div></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="progress-details">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div>${formatarValorFaltante(o.dadosAvanceFisico.meta, o.dadosAvanceFisico.atual, 'units', 'm')}</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div>Meta: <span>${formatUnits(o.dadosAvanceFisico.meta, 'm')}</span></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  </section>
Â  Â  Â  Â  Â  Â  Â  Â  <section class="metric-card danger-zone" ${adminOnlyDisplay}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h3>Zona de Perigo</h3>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p>A exclusÃ£o de um contrato Ã© permanente.</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button id="btn-excluir-contrato" data-obra-id="${o.id}">Excluir Contrato</button>
Â  Â  Â  Â  Â  Â  Â  Â  </section>
Â  Â  Â  Â  Â  Â  </div>`;
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  if (isAdmin) {
Â  Â  Â  Â  Â  Â  Â  Â  contentArea.querySelectorAll('input[type="text"]').forEach(i => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  i.addEventListener('input', handleInputFormatting);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  i.addEventListener('change', handleInputChange);
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â  const btnExcluir = document.getElementById('btn-excluir-contrato');
Â  Â  Â  Â  Â  Â  Â  Â  if (btnExcluir) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  btnExcluir.addEventListener('click', handleExcluirClick);
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  const handlePainelTVKeyPress = (event) => { if (event.key === 'ArrowRight') proximoSlide(); if (event.key === 'ArrowLeft') slideAnterior(); };
Â  Â  Â  Â  function proximoSlide() { if (slides.length === 0) return; slides[currentSlide].classList.remove('active'); currentSlide = (currentSlide + 1) % slides.length; slides[currentSlide].classList.add('active'); reiniciarTimerSlideshow(); }
Â  Â  Â  Â  function slideAnterior() { if (slides.length === 0) return; slides[currentSlide].classList.remove('active'); currentSlide = (currentSlide - 1 + slides.length) % slides.length; slides[currentSlide].classList.add('active'); reiniciarTimerSlideshow(); }
Â  Â  Â  Â  function reiniciarTimerSlideshow() { clearInterval(slideshowInterval); slideshowInterval = setInterval(proximoSlide, 10000); }
Â  Â  Â  Â Â 
Â  Â  Â  Â  function mostrarPainelTV() {Â 
Â  Â  Â  Â  Â  Â  const eI = new Date(Date.UTC(2025, 11, 15)), eE = new Date(Date.UTC(2025, 11, 31)), eA = new Date(Date.UTC(2026, 11, 31));Â 
Â  Â  Â  Â  Â  Â  const localToday = new Date();Â 
Â  Â  Â  Â  Â  Â  const today = new Date(Date.UTC(localToday.getUTCFullYear(), localToday.getUTCMonth(), localToday.getUTCDate()));Â 
Â  Â  Â  Â  Â  Â  const H = ['2025-10-12', '2025-11-02', '2025-11-15', '2025-12-25', '2026-01-01', '2026-04-03', '2026-04-21', '2026-05-01', '2026-06-04', '2026-09-07', '2026-10-12', '2026-11-02', '2026-11-15', '2026-12-25'];Â 
Â  Â  Â  Â  Â  Â  const tI = database.obras.reduce((s, o) => s + o.dadosImobilizacao.meta, 0), aI = database.obras.reduce((s, o) => s + o.dadosImobilizacao.atual, 0), tE = database.obras.reduce((s, o) => s + o.dadosEconomia.meta, 0), aE = database.obras.reduce((s, o) => s + o.dadosEconomia.atual, 0), tA = database.obras.reduce((s, o) => s + o.dadosAvanceFisico.meta, 0), aA = database.obras.reduce((s, o) => s + o.dadosAvanceFisico.atual, 0);Â 
Â  Â  Â  Â  Â  Â  const bDI = getBusinessDaysBetween(today, eI, H), bDE = getBusinessDaysBetween(today, eE, H), bDA = getBusinessDaysBetween(today, eA, H);Â 
Â  Â  Â  Â  Â  Â  const dIT = bDI > 0 ? (tI - aI) / bDI : 0, dET = bDE > 0 ? (tE - aE) / bDE : 0, dAT = bDA > 0 ? (tA - aA) / bDA : 0;Â 
Â  Â  Â  Â  Â  Â  const pI = calculatePercentage(aI, tI), pE = calculatePercentage(aE, tE), pA = calculatePercentage(aA, tA);Â 
Â  Â  Â  Â  Â  Â  contentArea.innerHTML = `<div class="slideshow-wrapper"><div class="slideshow-header"><h1>Painel TV</h1><button class="fullscreen-button" title="Modo Tela Cheia">ğŸ“º</button></div><div class="slideshow-content"></div><button class="exit-fullscreen-button">Sair</button></div>`;Â 
Â  Â  Â  Â  Â  Â  const sC = contentArea.querySelector('.slideshow-content');Â 
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // [ALTERAÃ‡ÃƒO] Removido 'casas'
Â  Â  Â  Â  Â  Â  // [ALTERAÃ‡ÃƒO] Adicionado 'economias' na funÃ§Ã£o formatarValorFaltante para Economias
Â  Â  Â  Â  Â  Â  sC.innerHTML = `<div class="panel-slide"><h2>Meta de ImobilizaÃ§Ã£o</h2><div class="progress-bar-container"><div class="progress-bar-fill" style="width:${pI > 100 ? 100 : pI.toFixed(2)}%;">${pI.toFixed(1).replace('.', ',')}%</div></div><div class="progress-details"><div>${formatarValorFaltante(tI, aI, 'currency')}</div><div>Executado: <span>${formatCurrency(aI)}</span></div><div>Meta DiÃ¡ria: <span>${formatCurrency(dIT)}</span></div><div>Dias Ãšteis: <span>${bDI}</span></div></div><div class="calendars" id="calendars-imob"></div></div>`Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â + `<div class="panel-slide"><h2>Meta de Economias</h2><div class="progress-bar-container"><div class="progress-bar-fill" style="width:${pE > 100 ? 100 : pE.toFixed(2)}%;background-color:#ff9800;">${pE.toFixed(1).replace('.', ',')}%</div></div><div class="progress-details"><div>${formatarValorFaltante(tE, aE, 'units', 'economias')}</div><div>AlcanÃ§ado: <span>${formatUnits(aE)}</span></div><div>Meta DiÃ¡ria: <span>${formatUnits(dET)}</span></div><div>Dias Ãšteis: <span>${bDE}</span></div></div><div class="calendars" id="calendars-econ"></div></div>`Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â + `<div class="panel-slide"><h2>AvanÃ§o FÃ­sico</h2><div class="progress-bar-sewage"><div class="progress-bar-fill-sewage" style="width:${pA > 100 ? 100 : pA.toFixed(2)}%;">${pA.toFixed(1).replace('.', ',')}%</div></div><div class="progress-details"><div>${formatarValorFaltante(tA, aA, 'units', 'm')}</div><div>Executado: <span>${formatUnits(aA, 'm')}</span></div><div>Meta DiÃ¡ria: <span>${formatUnits(dAT, 'm')}</span></div><div>Dias Ãšteis: <span>${bDA}</span></div></div><div class="calendars" id="calendars-avance"></div></div>`;Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â 
Â  Â  Â  Â  Â  Â  const { renderAllCalendars } = setupCalendarLogic(H);Â 
Â  Â  Â  Â  Â  Â  renderAllCalendars(today, eI, sC.querySelector('#calendars-imob'));Â 
Â  Â  Â  Â  Â  Â  renderAllCalendars(today, eE, sC.querySelector('#calendars-econ'));Â 
Â  Â  Â  Â  Â  Â  renderAllCalendars(today, eA, sC.querySelector('#calendars-avance'));Â 
Â  Â  Â  Â  Â  Â  slides = sC.querySelectorAll('.panel-slide');Â 
Â  Â  Â  Â  Â  Â  currentSlide = 0;Â 
Â  Â  Â  Â  Â  Â  if (slides.length > 0) { slides[currentSlide].classList.add('active'); reiniciarTimerSlideshow(); }Â 
Â  Â  Â  Â  Â  Â  document.querySelector('.fullscreen-button').addEventListener('click', enterFullScreenMode);Â 
Â  Â  Â  Â  Â  Â  document.querySelector('.exit-fullscreen-button').addEventListener('click', exitFullScreenMode);Â 
Â  Â  Â  Â  Â  Â  document.addEventListener('keydown', handlePainelTVKeyPress);Â 
Â  Â  Â  Â  }

Â  Â  Â  Â  function setupCalendarLogic(h) { const holidaySet = new Set(h); function rM(y, m, gC, tED) { const localToday = new Date(); const today = new Date(Date.UTC(localToday.getUTCFullYear(), localToday.getUTCMonth(), localToday.getUTCDate())); const fD = new Date(y, m, 1), dIM = new Date(y, m + 1, 0).getDate(), sDOW = fD.getDay(); let gCs = []; gCs.push('<div class="week-number-header"></div>'); ['D', 'S', 'T', 'Q', 'Q', 'S', 'S'].forEach(n => gCs.push(`<div class="day-name">${n}</div>`)); for (let i = 0; i < sDOW; i++) gCs.push('<div class="empty-day"></div>'); for (let d = 1; d <= dIM; d++) { const cD = new Date(Date.UTC(y, m, d)); const cDOW = cD.getUTCDay(); if (cDOW === 0) gCs.push(`<div class="week-number">${gWN(cD)}</div>`); let cls = ['day']; if (cD.getTime() === today.getTime()) { cls.push('today'); } else if (cD < today) { cls.push('past-day'); } if (cD.getTime() === tED.getTime()) { cls.push('end-date'); } else if (cD > today && cD <= tED) { const iso = cD.toISOString().split('T')[0]; if (holidaySet.has(iso)) cls.push('holiday'); else if (cDOW === 0 || cDOW === 6) cls.push('weekend'); else cls.push('future-workday'); } gCs.push(`<div class="${cls.join(' ')}"><span class="day-of-month">${d}</span></div>`); } gC.innerHTML = gCs.join(''); } function gWN(d) { d = new Date(d); d.setUTCDate(d.getUTCDate() + 4 - (d.getUTCDay() || 7)); const yS = new Date(Date.UTC(d.getUTCFullYear(), 0, 1)); const wN = Math.ceil((((d - yS) / 864e5) + 1) / 7); return wN; } return { renderAllCalendars: function (s, e, c) { if (!c) return; c.innerHTML = ''; const mN = ["Janeiro", "Fevereiro", "MarÃ§o", "Abril", "Maio", "Junho", "Julho", "Agosto", "Setembro", "Outubro", "Novembro", "Dezembro"]; let cD = new Date(s.getUTCFullYear(), s.getUTCMonth(), 1); while (cD <= e) { const y = cD.getFullYear(), m = cD.getMonth(); const mC = document.createElement('div'); mC.className = 'month'; mC.innerHTML = `<h3>${mN[m]} ${y}</h3><div class="calendar-grid"></div>`; const cG = mC.querySelector('.calendar-grid'); rM(y, m, cG, e); c.appendChild(mC); cD.setMonth(cD.getMonth() + 1); } } }; }
Â  Â  Â  Â Â 
Â  Â  Â  Â  function mostrarPaginaComuniqueses() {
Â  Â  Â  Â  Â  Â  const cs = database.comuniqueses || [];
Â  Â  Â  Â  Â  Â  const adminButton = isAdmin ? '<button id="btn-novo-cs" class="btn-primary">+ Novo Comunique-se</button>' : '';
Â  Â  Â  Â  Â  Â  const adminHeader = isAdmin ? '<th>AÃ§Ãµes</th>' : '';
Â  Â  Â  Â  Â  Â  contentArea.innerHTML = `
Â  Â  Â  Â  Â  Â  <div class="content-header">
Â  Â  Â  Â  Â  Â  Â  Â  <div><h1>Controle de "Comunique-se"</h1><p>GestÃ£o de prazos e respostas.</p></div>
Â  Â  Â  Â  Â  Â  Â  Â  ${adminButton}
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div class="cs-controls">
Â  Â  Â  Â  Â  Â  Â  Â  <input type="text" id="cs-search" placeholder="Buscar...">
Â  Â  Â  Â  Â  Â  Â  Â  <select id="cs-filter-status">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="todos">Todos</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="pendente">Pendentes</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="atrasado">Atrasados</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="respondido">Respondidos</option>
Â  Â  Â  Â  Â  Â  Â  Â  </select>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div class="cs-table-wrapper">
Â  Â  Â  Â  Â  Â  Â  Â  <table class="cs-table">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <thead>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <tr>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <th>Protocolo</th>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <th>Ã“rgÃ£o</th>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <th>Recebimento</th>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <th>Data Limite</th>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <th>Status</th>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <th>ResponsÃ¡vel</th>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${adminHeader}
Â  Â  Â  Â  Â  Â  Â  Â  Â  _**
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </tr>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </thead>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <tbody id="cs-table-body"></tbody>
Â  Â  Â  Â  Â  Â  Â  Â  </table>
Â  Â  Â  Â  Â  Â  </div>`;
Â  Â  Â  Â  Â  Â  renderarTabelaCS(cs);
Â  Â  Â  Â  Â  Â  if (isAdmin) {
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('btn-novo-cs').addEventListener('click', () => abrirModalCS());
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  document.getElementById('cs-search').addEventListener('input', filtrarTabelaCS);
Â  Â  Â  Â  Â  Â  document.getElementById('cs-filter-status').addEventListener('change', filtrarTabelaCS);
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  function renderarTabelaCS(cs) {
Â  Â  Â  Â  Â  Â  const tB = document.getElementById('cs-table-body');
Â  Â  Â  Â  Â  Â  if (!cs || cs.length === 0) {
Â  Â  Â  Â  Â  Â  Â  Â  tB.innerHTML = `<tr><td colspan="${isAdmin ? 7 : 6}" style="text-align:center;">Nenhum registro.</td></tr>`;
Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  tB.innerHTML = cs.map(c => {
Â  Â  Â  Â  Â  Â  Â  Â  const { sC, sT, pC } = calcularStatusPrazo(c.dataLimite, c.status);
Â  Â  Â  Â  Â  Â  Â  Â  const actionsCell = isAdmin ? `<td class="actions-cell"><button title="Editar" data-id="${c.id}" class="edit-cs-btn">âœï¸</button></td>` : '';
Â  Â  Â  Â  Â  Â  Â  Â  return `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <tr>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td>${c.protocolo}</td>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td>${c.orgaoEmissor}</td>
Â  Â  Â  Â  Â  _**
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td>${new Date(c.dataRecebimento + 'T00:00:00').toLocaleDateString('pt-BR', { timeZone: 'UTC' })}</td>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td class="${pC}">${new Date(c.dataLimite + 'T00:00:00').toLocaleDateString('pt-BR', { timeZone: 'UTC' })}</td>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td><span class="status-badge ${sC}">${sT}</span></td>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td>${c.responsavel || 'N/D'}</td>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${actionsCell}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </tr>
Â  Â  Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  Â  Â  }).join('');
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  if (isAdmin) {
Â  Â  Â  Â  Â  Â  Â  Â  document.querySelectorAll('.edit-cs-btn').forEach(b => b.addEventListener('click', e => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const id = e.currentTarget.dataset.id;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  abrirModalCS(id);
Ã‚Â  Â  Â  Â  Â  Â  Â  Â  }));
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  Â  Â  function calcularStatusPrazo(dL, s) { if (s === 'Respondido') return { sC: 'respondido', sT: 'Respondido', pC: '' }; const localToday = new Date(); const hoje = new Date(Date.UTC(localToday.getUTCFullYear(), localToday.getUTCMonth(), localToday.getUTCDate())); const p = new Date(dL + 'T00:00:00'); const dD = (p - hoje) / 864e5; if (dD < 0) return { sC: 'atrasado', sT: 'Atrasado', pC: 'prazo-vencido' }; if (dD <= 7) return { sC: 'pendente', sT: 'Pendente', pC: 'prazo-atencao' }; return { sC: 'pendente', sT: 'Pendente', pC: '' }; }
Â  Â  Â  Â  function filtrarTabelaCS() { const tB = document.getElementById('cs-search').value.toLowerCase(), sF = document.getElementById('cs-filter-status').value; const cF = (database.comuniqueses || []).filter(c => { const sI = calcularStatusPrazo(c.dataLimite, c.status); const cS = (sF === 'todos') || (sF === sI.sT.toLowerCase()); const cB = (c.protocolo.toLowerCase().includes(tB) || c.orgaoEmissor.toLowerCase().includes(tB) || c.assunto.toLowerCase().includes(tB)); return cS && cB; }); renderarTabelaCS(cF); }
Â  Â  Â  Â Â 
Â  Â  Â  Â  // =========================================================================
Â  Â  Â  Â  // [NOVA ALTERAÃ‡ÃƒO] NOVAS FUNÃ‡Ã•ES PARA LANÃ‡AMENTO DE HISTÃ“RICO (Passo 1)
Â  Â  Â  Â  // =========================================================================
Â  Â  Â  Â Â 
Â  Â  Â  Â  /**
Â  Â  Â  Â  * @author ERIVANDRO JUNIOR
Â  Â  Â  Â  * Gera o texto formatado a partir do banco de dados para o textarea.
Â  Â  Â  Â  */
Â  Â  Â  Â  function gerarTextoHistorico(obras) {
Â  Â  Â  Â  Â  Â  let output = [];
Â  Â  Â  Â  Â  Â  const tipos = [
Â  Â  Â  Â  Â  Â  Â  Â  { key: 'dadosImobilizacao', nome: 'ImobilizaÃ§Ã£o' },
Â  Â  Â  Â  Â  Â  Â  Â  { key: 'dadosEconomia', nome: 'Economia' },
Â  Â  Â  Â  Â  Â  Â  Â  { key: 'dadosAvanceFisico', nome: 'AvanÃ§o' } // Adicionando AvanÃ§o
Â  Â  Â  Â  Â  Â  ];

Â  Â  Â  Â  Â  Â  // Ordena as obras por nomeCurto
Â  Â  Â  Â  Â  Â  const obrasOrdenadas = [...obras].sort((a, b) => a.nomeCurto.localeCompare(b.nomeCurto));

Â  Â  Â  Â  Â  Â  for (const obra of obrasOrdenadas) {
Â  Â  Â  Â  Â  Â  Â  Â  output.push(`\n# ${obra.nomeCurto}`);
Â  Â  Â  Â  Â  Â  Â  Â  let hasEntries = false;

Â  Â  Â  Â  Â  Â  Â  Â  for (const tipo of tipos) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const dados = obra[tipo.key];
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (dados && dados.historico && dados.historico.length > 0) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Ordena o histÃ³rico por mÃªs
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  dados.historico.sort((a,b) => a.mes.localeCompare(b.mes));
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  for (const item of dados.historico) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Formato: TIPO, YYYY-MM, META, REALIZADO
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  output.push(`${tipo.nome}, ${item.mes}, ${item.meta || 0}, ${item.realizado || 0}`);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  hasEntries = true;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  if (!hasEntries) output.push(`(Nenhum histÃ³rico lanÃ§ado)`);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  return output.join('\n').trim();
Â  Â  Â  Â  }

Â  Â  Â  Â  /**
Â  Â  Â  Â  * @author ERIVANDRO JUNIOR
Â  Â  Â  Â  * Processa o texto do textarea e atualiza o database.
Â  Â  Â  Â  */
Â  Â  Â  Â  function handleSalvarHistorico() {
Â  Â  Â  Â  Â  Â  const text = document.getElementById('historico-textarea').value;
Â  Â  Â  Â  Â  Â  const lines = text.split('\n');
Â  Â  Â  Â  Â  Â  let currentObra = null;

Â  Â  Â  Â  Â  Â  if (!confirm("Tem certeza que deseja salvar? Isso irÃ¡ sobrescrever o histÃ³rico existente.")) {
Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  // 1. Limpa TODOS os histÃ³ricos existentes. O textarea Ã© a "fonte da verdade".
Â  Â  Â  Â  Â  Â  for (const obra of database.obras) {
Â  Â  Â  Â  Â  Â  Â  Â  if (obra.dadosImobilizacao) obra.dadosImobilizacao.historico = [];
Â  Â  Â  Â  Â  Â  Â  Â  if (obra.dadosEconomia) obra.dadosEconomia.historico = [];
Â  Â  Â  Â  Â  Â  Â  Â  if (obra.dadosAvanceFisico) obra.dadosAvanceFisico.historico = [];
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  // 2. Processa o texto linha por linha
Â  Â  Â  Â  Â  Â  for (const line of lines) {
Â  Â  Â  Â  Â  Â  Â  Â  const trimmedLine = line.trim();
Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  // Se a linha Ã© um Contrato (comeÃ§a com #)
Â  Â  Â  Â  Â  Â  Â  Â  if (trimmedLine.startsWith('#')) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const nomeCurto = trimmedLine.substring(1).trim();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  currentObra = database.obras.find(o => o.nomeCurto === nomeCurto);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (!currentObra) console.warn(`Obra nÃ£o encontrada: ${nomeCurto}`);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  continue; // Pula para a prÃ³xima linha
Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  // Ignora linhas se nÃ£o tiver contrato selecionado ou se for linha vazia/comentÃ¡rio
Â  Â  Â  Â  Â  Â  Â  Â  if (!currentObra || trimmedLine === "" || trimmedLine.startsWith('(')) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  continue;
Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  // Se a linha Ã© um dado (TIPO, MES, META, REALIZADO)
Â  Â  Â  Â  Â  Â  Â  Â  const parts = trimmedLine.split(',').map(s => s.trim());
Â  Â  Â  Â  Â  Â  Â  Â  if (parts.length !== 4) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.warn(`Linha mal formatada: ${trimmedLine}`);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  continue;
Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  const [tipo, mes, metaStr, realizadoStr] = parts;
Â  Â  Â  Â  Â  Â  Â  Â  const meta = parseFloat(metaStr) || 0;
Â  Â  Â  Â  Â  Â  Â  Â  const realizado = parseFloat(realizadoStr) || 0;

Â  Â  Â  Â  Â  Â  Â  Â  // ValidaÃ§Ã£o simples do mÃªs
Â  Â  Â  Â  Â  Â  Â  Â  if (!/^\d{4}-\d{2}$/.test(mes)) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.warn(`Formato de mÃªs invÃ¡lido: ${mes}. Use YYYY-MM.`);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  continue;
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  const newItem = { mes, meta, realizado };
Â  Â  Â  Â  Â  Â  Â  Â  let targetArray = null;

Â  Â  Â  Â  Â  Â  Â  Â  if (tipo.toLowerCase().startsWith('imobil')) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (!currentObra.dadosImobilizacao) currentObra.dadosImobilizacao = {};
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (!currentObra.dadosImobilizacao.historico) currentObra.dadosImobilizacao.historico = [];
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  targetArray = currentObra.dadosImobilizacao.historico;
Â  Â  Â  Â  Â  Â  Â  Â  } else if (tipo.toLowerCase().startsWith('econ')) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (!currentObra.dadosEconomia) currentObra.dadosEconomia = {};
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (!currentObra.dadosEconomia.historico) currentObra.dadosEconomia.historico = [];
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  targetArray = currentObra.dadosEconomia.historico;
Â  Â  Â  Â  Â  Â  Â  Â  } else if (tipo.toLowerCase().startsWith('avan')) { // Adicionamos 'AvanÃ§o'
Â  Â  Â  Â  Â  Â  Â  Â  Â  _**
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (!currentObra.dadosAvanceFisico) currentObra.dadosAvanceFisico = {};
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (!currentObra.dadosAvanceFisico.historico) currentObra.dadosAvanceFisico.historico = [];
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  targetArray = currentObra.dadosAvanceFisico.historico;
Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.warn(`Tipo desconhecido: ${tipo}`);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  continue;
Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  targetArray.push(newItem);
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  // 3. Manda salvar o database modificado
Â  Â  Â  Â  Â  Â  console.log("Database atualizado com histÃ³rico:", database);
Â  Â  Â  Â  Â  Â  alert("HistÃ³rico processado. Salvando no banco...");
Â  Â  Â  Â  Â  Â  salvarDados(true); // O 'true' faz a pÃ¡gina recarregar
Â  Â  Â  Â  }

Â  Â  Â  Â  /**
Â  Â  Â  Â  * @author ERIVANDRO JUNIOR
Â  Â  Â  Â  * Mostra a pÃ¡gina de inserÃ§Ã£o de histÃ³rico.
Â  Â  Â  Â  */
Â  Â  Â  Â  function mostrarPaginaHistorico() {
Â  Â  Â  Â  Â  Â  if (!isAdmin) {
Â  Â  Â  Â  Â  Â  Â  Â  contentArea.innerHTML = `<div class="content-header"><h1>Acesso Negado</h1><p>Esta Ã¡rea Ã© restrita.</p></div>`;
Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  // Gera o texto atual que estÃ¡ no banco, para facilitar a ediÃ§Ã£o
Â  Â  Â  Â  Â  Â  let currentText = gerarTextoHistorico(database.obras);

Â  Â  Â  Â  Â  Â  contentArea.innerHTML = `
Â  Â  Â  Â  Â  Â  Â  Â  <div class="content-header">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div><h1>LanÃ§ar HistÃ³rico Mensal</h1>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p>Use o formato abaixo. O salvamento <strong>sobrescreve todo</strong> o histÃ³rico anterior.</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="metric-card">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h3>InstruÃ§Ãµes</h3>
Â  Â  Â  Â  Â  _**
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <ul style="font-size: 0.9rem;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <li>Linhas com <code># Nome do Contrato</code> definem qual contrato os dados abaixo pertencem. (Ex: <code># Pacote 17A</code>)</li>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <li>Linhas de dados devem ter o formato: <code>TIPO, YYYY-MM, META, REALIZADO</code></li>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <li><strong>Tipos vÃ¡lidos:</strong> <code>ImobilizaÃ§Ã£o</code>, <code>Economia</code>, <code>AvanÃ§o</code> (sem acentos).</li>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <li><strong>Exemplo de linha de dado:</strong> <code>ImobilizaÃ§Ã£o, 2025-03, 50000, 65120.50</code></li>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <li><strong>Exemplo de linha de dado:</strong> <code>Economia, 2025-04, 100, 98</code></li>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </ul>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <textarea id="historico-textarea" 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  style="width: 100%; height: 50vh; font-family: 'Courier New', Courier, monospace; font-size: 14px; padding: 10px; border: 1px solid #ccc; border-radius: 8px;"
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  placeholder="# Pacote 17A\nImobilizaÃ§Ã£o, 2025-03, 50000, 65000\nEconomia, 2025-03, 100, 110\n\n# Pacote 17B\nImobilizaÃ§Ã£o, 2025-03, 30000, 32000"
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  >${currentText}</textarea>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div style="text-align: right; margin-top: 20px;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button id="btn-salvar-historico" class="btn-primary" style="background-color: #c82333;">Salvar e Sobrescrever HistÃ³rico</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  _**
Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  `;

Â  Â  Â  Â  Â  Â  // Adiciona o listener para o botÃ£o de salvar
Â  Â  Â  Â  Â  Â  document.getElementById('btn-salvar-historico').addEventListener('click', handleSalvarHistorico);
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  // =========================================================================
Â  Â  Â  Â  // FIM DAS NOVAS FUNÃ‡Ã•ES
Â  Â  Â  Â  // =========================================================================

Â  Â  Â  Â  async function carregarDados() {Â 
Â  Â  Â  Â  Â  Â  try {Â 
Â  Â  Â  Â  Â  Â  Â  Â  const r = await fetch(JSONBIN_URL, { headers: { 'X-Master-Key': API_KEY } });Â 
Â  Â  Â  Â  Â  Â  Â  Â  if (!r.ok) throw new Error(`Falha na rede: ${r.status}`);Â 
Â  Â  Â  Â  Â  Â  Â  Â  const d = await r.json();Â 
Â  Â  Â  Â  Â  Â  Â  Â  database = d.record;Â 
Â  Â  Â  Â  Â  Â  Â  Â  if (!database.obras) database.obras = [];Â 
Â  Â  Â  Â  Â  Â  Â  Â  if (!database.comuniqueses) database.comuniqueses = [];Â 
Â  Â  Â  Â  Â  Â  Â  Â  gerarNavegacao(database.obras);Â 
Â  Â  Â  Â  Â  Â  Â  Â  const linkAtivo = navList.querySelector('a.active');
Â  Â  Â  Â  Â  Â  Â  Â  if (linkAtivo) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  linkAtivo.click();
Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  mostrarPainelTV();
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  } catch (e) {Â 
Â  Â  Â  Â  Â  Â  Â  Â  console.error("Erro fatal:", e);Â 
Â  Â  Â  Â  Â  Â  Â  Â  contentArea.innerHTML = `<div class="content-header"><div><h1>Erro ao Carregar Dados</h1><p>NÃ£o foi possÃ­vel conectar. Verifique URL/Chave e conexÃ£o. Detalhes: ${e.message}</p></div></div>`;
Â  Â  Â  Â  Â  Â  }Â 
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  let saveTimeout;
Â  Â  Â  Â  function salvarDados(fU = false) {
Â  Â  Â  Â  Â  Â  if (!isAdmin) { console.warn("Modo de leitura. Salvamento bloqueado."); return; }
Â  Â  Â  Â  Â  Â  clearTimeout(saveTimeout);
Â  Â  Â  Â  Â  Â  saveTimeout = setTimeout(async () => {Â 
Â  Â  Â  Â  Â  Â  Â  Â  console.log("Salvando...");Â 
Â  Â  Â  Â  Â  Â  Â  Â  try {Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const r = await fetch(JSONBIN_URL, { method: 'PUT', headers: { 'Content-Type': 'application/json', 'X-Master-Key': API_KEY }, body: JSON.stringify(database) });Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (!r.ok) throw new Error('Falha ao salvar.');Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.log("Salvo!");Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (fU) {Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const aL = navList.querySelector('a.active');Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (aL) aL.click();Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }Â 
Â  Â  Â  Â  Â  Â  Â  Â  } catch (e) {Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.error("Erro ao salvar:", e);Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  alert("NÃ£o foi possÃ­vel salvar.");Â 
Â  Â  Â  Â  Â  Â  Â  Â  }Â 
Â  Â  Â  Â  Â  Â  }, 1500);
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  function handleNavClick(e) {Â 
Â  Â  Â  Â  Â  Â  e.preventDefault();Â 
Â  Â  Â  Â  Â  Â  document.removeEventListener('keydown', handlePainelTVKeyPress);Â 
Â  Â  Â  Â  Â  Â  clearInterval(slideshowInterval);Â 
Â  Â  Â  Â  Â  Â  const id = e.target.dataset.id;Â 
Â  Â  Â  Â  Â  Â  const cA = navList.querySelector('a.active');Â 
Â  Â  Â  Â  Â  Â  if (cA) cA.classList.remove('active');Â 
Â  Â  Â  Â  Â  Â  e.target.classList.add('active');Â 
Â  Â  Â  Â  Â  Â  if (document.fullscreenElement) document.exitFullscreen();Â 
Â  Â  Â  Â  Â  Â  sidebar.classList.remove('hidden');Â 
Â  Â  Â  Â  Â  Â  contentArea.classList.remove('fullscreen');Â 
Â  Â  Â  Â  Â  Â  if (id === 'visao-geral') mostrarVisaoGeral(database.obras);Â 
Â  Â  Â  Â  Â  Â  else if (id === 'painel-tv') mostrarPainelTV();Â 
Â  Â  Â  Â  Â  Â  else if (id === 'comuniqueses') mostrarPaginaComuniqueses();Â 
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  // [NOVA ALTERAÃ‡ÃƒO] Lida com o clique no novo botÃ£o
Â  Â  Â  Â  Â  Â  else if (id === 'lancar-historico') mostrarPaginaHistorico();
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  else { const o = database.obras.find(x => x.id === id); if (o) mostrarPaginaObra(o); }Â 
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  function handleInputChange(e) { const i = e.target, oId = i.dataset.obraId, t = i.dataset.tipo; let vN = parseFloat(i.value.replace(/\./g, '').replace(',', '.')) || 0; const o = database.obras.find(x => x.id === oId); if (!o) return; switch (t) { case 'imobilizacao': o.dadosImobilizacao.atual = vN; break; case 'economia': o.dadosEconomia.atual = Math.round(vN); break; case 'avance': o.dadosAvanceFisico.atual = Math.round(vN); break; } salvarDados(); }
Â  Â  Â  Â  function handleInputFormatting(e) { const i = e.target, t = i.dataset.tipo; let v = i.value.replace(/\D/g, ''); if (v === '') { i.value = ''; return; } if (t.includes('imobilizacao')) { const nV = parseInt(v, 10) / 100; i.value = nV.toLocaleString('pt-BR', { minimumFractionDigits: 2 }); } else { i.value = parseInt(v, 10).toLocaleString('pt-BR'); } }
Â  Â  Â  Â  function handleExcluirClick(e) { const oId = e.target.dataset.obraId; const o = database.obras.find(x => x.id === oId); if (!o) return; if (confirm(`Excluir "${o.nomeCompleto}"?\nAÃ§Ã£o permanente.`)) { const idx = database.obras.findIndex(x => x.id === oId); if (idx > -1) { database.obras.splice(idx, 1); salvarDados(true); gerarNavegacao(database.obras); navList.querySelector('a[data-id="visao-geral"]').click(); } } }
Â  Â  Â  Â Â 
Â  Â  Â  Â  const modalObras = document.getElementById('modal-novo-contrato');
Â  Â  Â  Â  const formObras = document.getElementById('form-novo-contrato');
Â  Â  Â  Â  const btnAddObra = document.getElementById('btn-adicionar-contrato');
Â  Â  Â  Â  modalObras.querySelectorAll('.close-button').forEach(b => b.addEventListener('click', () => fecharModal(modalObras, formObras)));
Â  Â  Â  Â  modalObras.addEventListener('click', e => { if (e.target === modalObras) fecharModal(modalObras, formObras); });
Â  Â  Â  Â Â 
Â  Â  Â  Â  if (!isAdmin) {
Â  Â  Â  Â  Â  Â  btnAddObra.style.display = 'none';
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  btnAddObra.addEventListener('click', () => abrirModal(modalObras));
Â  Â  Â  Â  Â  Â  formObras.addEventListener('submit', e => {
Â  Â  Â  Â  Â  Â  Â  Â  e.preventDefault();
Â  Â  Â  Â  Â  Â  Â  Â  const nO = { id: `obra-${Date.now()}`, nomeCurto: formObras.querySelector('#nome-curto').value, nomeCompleto: formObras.querySelector('#nome-completo').value, dadosImobilizacao: { meta: parseFloat(formObras.querySelector('#meta-imob').value) || 0, atual: 0 }, dadosEconomia: { meta: parseInt(formObras.querySelector('#meta-econ').value, 10) || 0, atual: 0 }, dadosAvanceFisico: { meta: parseInt(formObras.querySelector('#meta-avance').value, 10) || 0, atual: 0 } };
Â  Â  Â  Â  Â  Â  Â  Â  database.obras.push(nO);
Â  Â  Â  Â  Â  Â  Â  Â  salvarDados(true);
Â  Â  Â  Â  Â  Â  Â  Â  gerarNavegacao(database.obras);
Â  Â  Â  Â  Â  Â  Â  Â  fecharModal(modalObras, formObras);
Â  Â  Â  Â  Â  Â  Â  Â  navList.querySelector('a[data-id="visao-geral"]').click();
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  }

Â  Â  Â  Â  const modalCS = document.getElementById('modal-comuniquese');
Â  Â  Â  Â  const formCS = document.getElementById('form-comuniquese');
Â  Â  Â  Â  modalCS.querySelectorAll('.close-button').forEach(b => b.addEventListener('click', () => fecharModal(modalCS, formCS)));
Â  Â  Â  Â  modalCS.addEventListener('click', e => { if (e.target === modalCS) fecharModal(modalCS, formCS); });
Â  Â  Â  Â Â 
Â  Â  Â  Â  function abrirModalCS(id = null) {
Â  Â  Â  Â  Â  Â  if (!isAdmin) return;
Â  Â  Â  Â  Â  Â  formCS.reset();
Â  Â  Â  Â  Â  Â  const title = modalCS.querySelector('#modal-cs-title');
Â  Â  Â  Â  Â  Â  if (id) { const c = database.comuniqueses.find(x => x.id === id); if (!c) return; title.textContent = "Editar Comunique-se"; document.getElementById('cs-id').value = c.id; document.getElementById('cs-protocolo').value = c.protocolo; document.getElementById('cs-orgao').value = c.orgaoEmissor; document.getElementById('cs-data-recebimento').value = c.dataRecebimento; document.getElementById('cs-prazo-dias').value = c.prazoDias; document.getElementById('cs-assunto').value = c.assunto; document.getElementById('cs-responsavel').value = c.responsavel; document.getElementById('cs-status').value = c.status; document.getElementById('cs-data-resposta').value = c.dataResposta || ''; document.getElementById('cs-oficio-resposta').value = c.oficioResposta || ''; document.getElementById('cs-observacao').value = c.observacao || ''; } else { title.textContent = "Novo Comunique-se"; document.getElementById('cs-id').value = ''; }
Â  Â  Â  Â  Â  Â  abrirModal(modalCS);
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  if (isAdmin) {
Â  Â  Â  Â  Â  Â  formCS.addEventListener('submit', e => {
Â  Â  Â  Â  Â  Â  Â  Â  e.preventDefault();
Â  Â  Â  Â  Â  Â  Â  Â  const id = document.getElementById('cs-id').value;
Â  Â  Â  Â  Â  Â  Â  Â  const dR = new Date(document.getElementById('cs-data-recebimento').value + 'T00:00:00');
Â  Â  Â  Â  Â  Â  Â  Â  const pD = parseInt(document.getElementById('cs-prazo-dias').value, 10);
Â  T00:00:00');
Â  Â  Â  Â  Â  Â  Â  Â  const dL = dR.toISOString().split('T')[0];
Â  Â  Â  Â  Â  Â  Â  Â  const cD = { protocolo: document.getElementById('cs-protocolo').value, orgaoEmissor: document.getElementById('cs-orgao').value, dataRecebimento: document.getElementById('cs-data-recebimento').value, prazoDias: pD, dataLimite: dL, assunto: document.getElementById('cs-assunto').value, responsavel: document.getElementById('cs-responsavel').value, status: document.getElementById('cs-status').value, dataResposta: document.getElementById('cs-data-resposta').value || null, oficioResposta: document.getElementById('cs-oficio-resposta').value || '', observacao: document.getElementById('cs-observacao').value || '', };
Â  Â  Â  Â  Â  Â  Â  Â  if (id) { const idx = database.comuniqueses.findIndex(c => c.id === id); if (idx > -1) database.comuniqueses[idx] = { ...database.comuniqueses[idx], ...cD }; } else { cD.id = `com-${Date.now()}`; database.comuniqueses.push(cD); }
Â  Â  Â  Â  Â  Â  Â  Â  salvarDados(true);
Â  Â  Â  Â  Â  Â  Â  Â  fecharModal(modalCS, formCS);
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  function abrirModal(m) { m.classList.add('active'); } function fecharModal(m, f) { m.classList.remove('active'); if (f) f.reset(); }
Â  Â  Â  Â  function enterFullScreenMode() { sidebar.classList.add('hidden'); contentArea.classList.add('fullscreen'); document.documentElement.requestFullscreen().catch(e => console.error(e)); }
Â  Â  Â  Â  function exitFullScreenMode() { if (document.fullscreenElement) document.exitFullscreen(); sidebar.classList.remove('hidden'); contentArea.classList.remove('fullscreen'); }
Â  Â  Â  Â  document.addEventListener('fullscreenchange', () => { if (!document.fullscreenElement) exitFullScreenMode(); });
Â  Â  Â  Â  document.addEventListener('keydown', e => { if (e.key === 'Escape' && document.fullscreenElement) exitFullScreenMode(); });
Â  Â  Â  Â Â 

Â  Â  Â  Â  // --- LÃ³gica para o menu hamburger ---
Â  Â  Â  Â  const toggleBtn = document.getElementById('sidebar-toggle-btn');
Â  Â  Â  Â  const sidebarEl = document.querySelector('.sidebar');
Â  Â  Â  Â  const overlayEl = document.getElementById('sidebar-overlay');

Â  Â  Â  Â  function openSidebar() {
Â  Â  Â  Â  Â  Â  sidebarEl.classList.add('is-open');
nbsp; Â  Â  Â  Â  Â  Â  toggleBtn.setAttribute('aria-expanded', 'true');
Â  Â  Â  Â  }

Â  Â  Â  Â  function closeSidebar() {
Â  Â  Â  Â  Â  Â  sidebarEl.classList.remove('is-open');
Â  Â  Â  Â  Â  Â  overlayEl.classList.remove('is-open');
Â  Â  Â  Â  Â  Â  toggleBtn.setAttribute('aria-expanded', 'false');
Â  Â  Â  Â  }

Â  Â  Â  Â  toggleBtn.addEventListener('click', () => {
Â  Â  Â  Â  Â  Â  if (sidebarEl.classList.contains('is-open')) {
Â  Â  Â  Â  Â  Â  Â  Â  closeSidebar();
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  openSidebar();
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  });

Â  Â  Â  Â  overlayEl.addEventListener('click', closeSidebar);
Â  Â  Â  Â Â 
Â  Â  Â  Â  navList.addEventListener('click', (e) => {
Â  Â  Â  Â  Â  Â  if (e.target.tagName === 'A' && window.innerWidth <= 768) {
Â  Â  Â  Â  Â  Â  Â  Â  closeSidebar();
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  });

Â  Â  Â  Â  carregarDados();
Â  Â  });
Â  Â  </script>
</body>
</html>
